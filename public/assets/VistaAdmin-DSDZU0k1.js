import{o as re,h as ue,a as i,b as e,j as H,t as a,r as l,n as v,w as I,k as y,f as S,v as A,F as R,d as T,g as ce,c as p,e as r}from"./index-kENfiCDL.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";const me={class:"admin-body-container"},ve={class:"admin-topbar"},pe={class:"admin-topbar-content"},be={class:"admin-brand"},fe={class:"admin-user-info"},he=["aria-expanded"],ge={class:"admin-main"},_e={class:"admin-dashboard"},ye={class:"stats-grid"},De={class:"stat-card"},ke={class:"stat-info"},Ce={class:"stat-card"},we={class:"stat-info"},Fe={class:"stat-card"},Se={class:"stat-info"},Ae={class:"stat-card"},Ee={class:"stat-info"},xe={class:"admin-tabs-section"},$e={class:"tabs-header"},Me={class:"admin-card"},Pe={class:"form-row"},Ve={class:"form-group"},je={class:"form-group"},ze={class:"form-group"},Be={class:"form-group"},Ne={class:"file-input-wrapper"},qe={class:"file-input-label"},Ue={class:"preview-grid"},Ie=["src"],Re={key:0,class:"progress-container"},Te=["value"],Ge=["disabled"],Le={key:1,class:"error-msg",role:"alert"},He={key:2,class:"success-msg",role:"status"},Je={class:"admin-card"},Oe={class:"form-row"},Xe={class:"form-group"},Ke={class:"form-group"},Qe={class:"form-group"},We={class:"file-input-wrapper"},Ye={class:"file-input-label"},Ze={key:0,class:"progress-container"},es=["value"],ss=["disabled"],os={key:1,class:"error-msg",role:"alert"},ts={key:2,class:"success-msg",role:"status"},as={class:"admin-card"},ls={class:"content-list"},ns={key:0,class:"loading-content"},is={key:1,class:"empty-list"},rs={class:"content-info"},us={class:"content-meta"},cs=["onClick"],ds={class:"admin-card"},ms={class:"content-list"},vs={key:0,class:"loading-content"},ps={key:1,class:"empty-list"},bs={class:"content-info"},fs={class:"content-meta"},hs=["onClick"],gs={class:"modal-container"},_s={class:"modal-header"},ys={class:"modal-body"},Ds={class:"modal-hint"},ks={class:"modal-footer"},J=30,O=10,Cs={__name:"VistaAdmin",setup(ws){const G=ce(),X=l(""),L=l(""),E=l(!1),d=l("albums"),m=l({albums:0,docs:0,fotos:0,ultimaFecha:"--"}),c=l({titulo:"",fecha:"",descripcion:"",fotos:[]}),D=l([]),x=l(0),b=l(""),k=l(""),C=l(!1),f=l({titulo:"",mes:"",archivo:null}),$=l("Haz clic para seleccionar archivo PDF"),M=l(0),g=l(""),P=l(""),w=l(!1),j=l([]),z=l([]),V=l(!1),B=l(!1),h=l({titulo:"",mensaje:"",pista:"",textoConfirmar:"",accion:null}),K=()=>{const t=localStorage.getItem("token"),s=localStorage.getItem("usuario");if(!t||!s)return G.push("/login"),!1;X.value=s;const o={"directora@amatal.edu.sv":"Directora","ericka.flores@clases.edu.sv":"Subdirectora","borisstanleylazocastillo@gmail.com":"Desarrollador"};return L.value=o[s]||s,!0},F=async()=>{try{const t=await p.obtener("/api/albums"),s=await p.obtener("/api/docs");m.value.albums=t.length,m.value.docs=s.length,m.value.fotos=t.reduce((o,n)=>o+(n.fotos?.length||0),0),t.length>0&&(m.value.ultimaFecha=new Date(t[0].fecha).toLocaleDateString("es-SV"))}catch(t){console.error("Error al cargar estad√≠sticas:",t)}},Q=t=>{const s=Array.from(t.target.files);if(b.value="",k.value="",s.length>J){b.value=`M√°ximo ${J} fotos`,t.target.value="",c.value.fotos=[],D.value=[];return}c.value.fotos=s,D.value=[],s.forEach(o=>{if(o.type!=="image/jpeg")return;const n=new FileReader;n.onload=u=>{D.value.push(u.target.result)},n.readAsDataURL(o)})},W=async()=>{b.value="",k.value="";const{titulo:t,fecha:s,descripcion:o,fotos:n}=c.value;if(!t||!s||n.length===0){b.value="Completa t√≠tulo, fecha y al menos una foto";return}const u=new FormData;u.append("titulo",t),u.append("fecha",s),u.append("descripcion",o),n.forEach(_=>u.append("fotos",_)),C.value=!0;try{const _=await p.subir("/api/albums",u,ie=>{x.value=ie});k.value=`‚úÖ √Ålbum "${_.album.titulo}" publicado con ${_.album.fotos.length} fotos.`,c.value={titulo:"",fecha:"",descripcion:"",fotos:[]},D.value=[],x.value=0,F()}catch(_){b.value="‚ùå "+_.message}finally{C.value=!1}},Y=t=>{const s=t.target.files[0];s?(f.value.archivo=s,$.value=s.name):$.value="Haz clic para seleccionar archivo PDF"},Z=async()=>{g.value="",P.value="";const{titulo:t,mes:s,archivo:o}=f.value;if(!t||!s||!o){g.value="Completa t√≠tulo, mes y selecciona un PDF";return}if(o.size>O*1024*1024){g.value=`M√°ximo ${O} MB por PDF`;return}const n=new FormData;n.append("titulo",t),n.append("mes",s),n.append("doc",o),w.value=!0;try{await p.subir("/api/docs",n,u=>{M.value=u}),P.value=`‚úÖ PDF "${t}" subido correctamente.`,f.value={titulo:"",mes:"",archivo:null},$.value="Haz clic para seleccionar archivo PDF",M.value=0,F()}catch(u){g.value="‚ùå "+u.message}finally{w.value=!1}},N=async()=>{try{V.value=!0,j.value=await p.obtener("/api/albums"),z.value=await p.obtener("/api/docs")}catch(t){console.error("Error al cargar listas:",t)}finally{V.value=!1}},ee=t=>{q("üóëÔ∏è Eliminar √Ålbum",`¬øEst√°s seguro de eliminar "${t.titulo}"?`,`Se eliminar√°n ${t.fotos.length} fotos. Esta acci√≥n no se puede deshacer.`,"Eliminar",()=>se(t.id))},se=async t=>{try{await p.eliminar(`/api/albums/${t}`),N(),F()}catch{alert("Error al eliminar el √°lbum")}},oe=t=>{q("üóëÔ∏è Eliminar Documento",`¬øEst√°s seguro de eliminar "${t.titulo}"?`,"Esta acci√≥n no se puede deshacer.","Eliminar",()=>te(t.id))},te=async t=>{try{await p.eliminar(`/api/docs/${t}`),N(),F()}catch{alert("Error al eliminar el documento")}},q=(t,s,o,n,u)=>{h.value={titulo:t,mensaje:s,pista:o,textoConfirmar:n,accion:u},B.value=!0},U=()=>{B.value=!1},ae=()=>{h.value.accion&&h.value.accion(),U()},le=()=>{q("üö™ Cerrar Sesi√≥n","¬øEst√°s seguro de que deseas cerrar sesi√≥n?","Perder√°s cualquier progreso no guardado.","Cerrar Sesi√≥n",()=>{localStorage.removeItem("token"),localStorage.removeItem("usuario"),G.push("/login")})},ne=t=>{const[s,o]=t.split("-");return`${["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"][parseInt(o)-1]} ${s}`};return re(()=>{K()&&F()}),ue(d,t=>{t==="gestionar"&&N()}),(t,s)=>(r(),i("div",me,[e("header",ve,[e("div",pe,[e("div",be,[s[10]||(s[10]=e("h1",null,"üìö Panel de Administraci√≥n",-1)),e("p",fe,[s[9]||(s[9]=H("Bienvenido, ",-1)),e("span",null,a(L.value),1)])]),e("button",{class:"admin-menu-toggle",onClick:s[0]||(s[0]=o=>E.value=!E.value),"aria-expanded":E.value},[...s[11]||(s[11]=[e("span",{class:"sr-only"},"Abrir men√∫",-1),H("‚ò∞ ",-1)])],8,he),e("nav",{class:v(["admin-actions",{show:E.value}])},[e("button",{onClick:le,class:"btn-danger"},"üö™ Cerrar sesi√≥n")],2)])]),e("main",ge,[e("section",_e,[s[20]||(s[20]=e("h2",null,"Resumen General",-1)),e("div",ye,[e("div",De,[s[13]||(s[13]=e("div",{class:"stat-icon"},"üì∏",-1)),e("div",ke,[e("h3",null,a(m.value.albums),1),s[12]||(s[12]=e("p",null,"√Ålbumes publicados",-1))])]),e("div",Ce,[s[15]||(s[15]=e("div",{class:"stat-icon"},"üìÑ",-1)),e("div",we,[e("h3",null,a(m.value.docs),1),s[14]||(s[14]=e("p",null,"Documentos subidos",-1))])]),e("div",Fe,[s[17]||(s[17]=e("div",{class:"stat-icon"},"üñºÔ∏è",-1)),e("div",Se,[e("h3",null,a(m.value.fotos),1),s[16]||(s[16]=e("p",null,"Fotos totales",-1))])]),e("div",Ae,[s[19]||(s[19]=e("div",{class:"stat-icon"},"üìÖ",-1)),e("div",Ee,[e("h3",null,a(m.value.ultimaFecha),1),s[18]||(s[18]=e("p",null,"√öltima actualizaci√≥n",-1))])])])]),e("section",xe,[e("div",$e,[e("button",{class:v(["tab-btn",{active:d.value==="albums"}]),onClick:s[1]||(s[1]=o=>d.value="albums")}," üì∏ Subir √Ålbum ",2),e("button",{class:v(["tab-btn",{active:d.value==="documentos"}]),onClick:s[2]||(s[2]=o=>d.value="documentos")}," üìÑ Subir Documento ",2),e("button",{class:v(["tab-btn",{active:d.value==="gestionar"}]),onClick:s[3]||(s[3]=o=>d.value="gestionar")}," ‚öôÔ∏è Gestionar Contenido ",2)]),e("div",{class:v(["tab-content",{active:d.value==="albums"}])},[e("div",Me,[s[25]||(s[25]=e("h3",null,"üì§ Publicar Nuevo √Ålbum",-1)),e("form",{onSubmit:I(W,["prevent"]),class:"admin-form"},[e("div",Pe,[e("div",Ve,[s[21]||(s[21]=e("label",{for:"titulo"},"T√≠tulo del evento *",-1)),S(e("input",{type:"text",id:"titulo","onUpdate:modelValue":s[4]||(s[4]=o=>c.value.titulo=o),placeholder:"Ej: Feria de Ciencias 2025",required:""},null,512),[[A,c.value.titulo]])]),e("div",je,[s[22]||(s[22]=e("label",{for:"fecha"},"Fecha del evento *",-1)),S(e("input",{type:"date",id:"fecha","onUpdate:modelValue":s[5]||(s[5]=o=>c.value.fecha=o),required:""},null,512),[[A,c.value.fecha]])])]),e("div",ze,[s[23]||(s[23]=e("label",{for:"descripcion"},"Descripci√≥n (opcional)",-1)),S(e("textarea",{id:"descripcion","onUpdate:modelValue":s[6]||(s[6]=o=>c.value.descripcion=o),rows:"3",placeholder:"Breve rese√±a del evento"},null,512),[[A,c.value.descripcion]])]),e("div",Be,[s[24]||(s[24]=e("label",{for:"fotos"},"Seleccionar fotos (m√°x. 30, solo JPG) *",-1)),e("div",Ne,[e("input",{type:"file",id:"fotos",onChange:Q,accept:"image/jpeg",multiple:"",required:""},null,32),e("span",qe,a(c.value.fotos.length>0?`${c.value.fotos.length} archivo(s) seleccionado(s)`:"Haz clic para seleccionar archivos"),1)])]),e("div",Ue,[(r(!0),i(R,null,T(D.value,(o,n)=>(r(),i("img",{key:n,src:o,alt:"preview"},null,8,Ie))),128))]),C.value?(r(),i("div",Re,[e("progress",{value:x.value,max:"100"},null,8,Te),e("span",null,a(x.value)+"%",1)])):y("",!0),e("button",{type:"submit",class:"btn-primary",disabled:C.value},a(C.value?"Subiendo‚Ä¶":"Publicar √°lbum"),9,Ge),b.value?(r(),i("p",Le,a(b.value),1)):y("",!0),k.value?(r(),i("p",He,a(k.value),1)):y("",!0)],32)])],2),e("div",{class:v(["tab-content",{active:d.value==="documentos"}])},[e("div",Je,[s[30]||(s[30]=e("h3",null,"üì§ Subir Nuevo Documento",-1)),e("form",{onSubmit:I(Z,["prevent"]),class:"admin-form"},[e("div",Oe,[e("div",Xe,[s[26]||(s[26]=e("label",{for:"doc-titulo"},"T√≠tulo del documento *",-1)),S(e("input",{type:"text",id:"doc-titulo","onUpdate:modelValue":s[7]||(s[7]=o=>f.value.titulo=o),placeholder:"Ej: Rendici√≥n de Cuentas - Junio 2025",required:""},null,512),[[A,f.value.titulo]])]),e("div",Ke,[s[27]||(s[27]=e("label",{for:"doc-mes"},"Mes del documento *",-1)),S(e("input",{type:"month",id:"doc-mes","onUpdate:modelValue":s[8]||(s[8]=o=>f.value.mes=o),required:""},null,512),[[A,f.value.mes]])])]),e("div",Qe,[s[28]||(s[28]=e("label",{for:"doc-file"},"Seleccionar PDF (m√°x. 10 MB) *",-1)),e("div",We,[e("input",{type:"file",id:"doc-file",onChange:Y,accept:".pdf",required:""},null,32),e("span",Ye,a($.value),1)]),s[29]||(s[29]=e("small",{class:"form-hint"},"Tama√±o m√°ximo: 10 MB",-1))]),w.value?(r(),i("div",Ze,[e("progress",{value:M.value,max:"100"},null,8,es),e("span",null,a(M.value)+"%",1)])):y("",!0),e("button",{type:"submit",class:"btn-primary",disabled:w.value},a(w.value?"Subiendo‚Ä¶":"Subir documento"),9,ss),g.value?(r(),i("p",os,a(g.value),1)):y("",!0),P.value?(r(),i("p",ts,a(P.value),1)):y("",!0)],32)])],2),e("div",{class:v(["tab-content",{active:d.value==="gestionar"}])},[e("div",as,[s[31]||(s[31]=e("h3",null,"üì∏ √Ålbumes Publicados",-1)),e("div",ls,[V.value?(r(),i("p",ns,"Cargando √°lbumes...")):j.value.length===0?(r(),i("p",is,"No hay √°lbumes publicados.")):(r(!0),i(R,{key:2},T(j.value,o=>(r(),i("div",{key:o.id,class:"content-item"},[e("div",rs,[e("h4",null,a(o.titulo),1),e("div",us,[e("span",null,"üìÖ "+a(new Date(o.fecha).toLocaleDateString("es-SV")),1),e("span",null,"üì∏ "+a(o.fotos.length)+" fotos",1)])]),e("button",{class:"btn-delete",onClick:n=>ee(o)},"üóëÔ∏è Eliminar",8,cs)]))),128))])]),e("div",ds,[s[33]||(s[33]=e("h3",null,"üìÑ Documentos Publicados",-1)),e("div",ms,[V.value?(r(),i("p",vs,"Cargando documentos...")):z.value.length===0?(r(),i("p",ps,"No hay documentos publicados.")):(r(!0),i(R,{key:2},T(z.value,o=>(r(),i("div",{key:o.id,class:"content-item"},[e("div",bs,[e("h4",null,a(o.titulo),1),e("div",fs,[e("span",null,"üìÖ "+a(ne(o.mes)),1),s[32]||(s[32]=e("span",null,"üìÑ PDF",-1))])]),e("button",{class:"btn-delete",onClick:n=>oe(o)},"üóëÔ∏è Eliminar",8,hs)]))),128))])])],2)])]),e("div",{class:v(["modal-overlay",{active:B.value}]),onClick:I(U,["self"])},[e("div",gs,[e("div",_s,[e("h3",null,a(h.value.titulo),1)]),e("div",ys,[e("p",null,a(h.value.mensaje),1),e("p",Ds,a(h.value.pista),1)]),e("div",ks,[e("button",{onClick:U,class:"btn-modal btn-modal-cancel"},"Cancelar"),e("button",{onClick:ae,class:"btn-modal btn-modal-confirm"},a(h.value.textoConfirmar),1)])])],2)]))}},As=de(Cs,[["__scopeId","data-v-1b4fe27c"]]);export{As as default};
